async function renderChecklist() {
  if (loading) return;
  if (!contactId) {
    container.innerHTML = "<p style='color:red;'>No contactId in URL.</p>";
    return;
  }

  if (!loadedOnce) {
    container.innerHTML = `
      <div id="onboarding-spinner">
        <div class="spinner"></div>
        <div>Fetching your detailsâ€¦</div>
      </div>
    `;
  }

  loading = true;

  try {
    const response = await fetch(`https://ghl-proxy.fly.dev/contact/${contactId}`);
    if (!response.ok) {
      throw new Error(`Fetch error: ${response.status}`);
    }
    const data = await response.json();
    loadedOnce = true;

    const contact = data.contact || {};
    const tags = contact.tags || [];
    const fieldsArr = Array.isArray(contact.customField) ? contact.customField : [];
    const getF = id => {
      const f = fieldsArr.find(f => f.id === id);
      return f ? f.value : "";
    };

    if (appDownloadRow) appDownloadRow.style.display = 'block';

    let html = "";

    // Render your details
    try {
      html += renderYourDetailsSection(contact, fieldsArr);
    } catch (e) {
      html += `<p style="color:red;">Error rendering details: ${e.message}</p>`;
    }

    // Render staff view if flagged
    if (isStaff) {
      html += `
        <h2>Staff View</h2>
        <div class="details-table">
          <div class="details-header">Staff Details</div>
          <table style="border-collapse:collapse;width:100%;background:none;">
            <tr><th class="details-label">Phone:</th><td>${getF(FIELDS.PHONE)}</td></tr>
            <tr><th class="details-label">Tags:</th><td>${tags.join(", ")}</td></tr>
            <tr><th class="details-label">Appointment Date:</th><td>${getF(FIELDS.APPT_DATE)}</td></tr>
            <tr><th class="details-label">Appointment Time:</th><td>${getF(FIELDS.APPT_TIME)}</td></tr>
            <tr><th class="details-label">Assigned Coach:</th><td>${getF(FIELDS.APPT_COACH)}</td></tr>
          </table>
        </div>
      `;
    }

    container.innerHTML = html;

  } catch (error) {
    container.innerHTML = `<p style='color:red;'>Error loading data:<br>${error.message}</p>`;
  }

  loading = false;
}
